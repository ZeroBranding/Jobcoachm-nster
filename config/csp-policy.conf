# Content Security Policy Konfiguration
# JobCoach Münster - Detaillierte CSP-Richtlinien

# =============================================================================
# PRODUCTION CSP (Streng)
# =============================================================================

# Für Produktionsumgebung - maximale Sicherheit
PRODUCTION_CSP="
    default-src 'self';
    script-src 'self' 'nonce-{RANDOM_NONCE}' https://cdn.jsdelivr.net https://unpkg.com;
    style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
    font-src 'self' https://fonts.gstatic.com;
    img-src 'self' data: https: blob:;
    media-src 'self';
    connect-src 'self' https://api.jobcoach-muenster.de;
    frame-src 'none';
    frame-ancestors 'none';
    object-src 'none';
    base-uri 'self';
    form-action 'self';
    manifest-src 'self';
    worker-src 'self';
    child-src 'none';
    upgrade-insecure-requests;
    block-all-mixed-content;
"

# =============================================================================
# DEVELOPMENT CSP (Weniger streng für Entwicklung)
# =============================================================================

# Für Entwicklungsumgebung - erlaubt localhost und Hot-Reload
DEVELOPMENT_CSP="
    default-src 'self' 'unsafe-inline' 'unsafe-eval';
    script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://unpkg.com localhost:* ws://localhost:*;
    style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
    font-src 'self' https://fonts.gstatic.com data:;
    img-src 'self' data: https: blob: localhost:*;
    media-src 'self' blob:;
    connect-src 'self' https: wss: ws://localhost:* http://localhost:*;
    frame-src 'self';
    object-src 'none';
    base-uri 'self';
    form-action 'self';
"

# =============================================================================
# CSP DIREKTIVEN ERKLÄRT
# =============================================================================

# default-src 'self'
# → Fallback für alle nicht explizit definierten Direktiven
# → Nur Inhalte von der eigenen Domain erlaubt

# script-src 'self' 'nonce-{RANDOM_NONCE}'
# → JavaScript nur von eigener Domain und mit Nonce
# → CDNs für Three.js und andere Bibliotheken erlaubt
# → 'unsafe-inline' vermieden für bessere Sicherheit

# style-src 'self' 'unsafe-inline'
# → CSS von eigener Domain und inline-Styles
# → Google Fonts erlaubt für Typografie
# → 'unsafe-inline' für dynamische Styles notwendig

# img-src 'self' data: https: blob:
# → Bilder von eigener Domain, Data-URLs, HTTPS-Quellen
# → Blob-URLs für dynamisch generierte Inhalte

# connect-src 'self'
# → AJAX/Fetch nur zur eigenen API
# → WebSocket-Verbindungen zur eigenen Domain

# frame-src 'none' / frame-ancestors 'none'
# → Keine iFrames erlaubt (Clickjacking-Schutz)
# → Website kann nicht in iFrames eingebettet werden

# object-src 'none'
# → Keine Plugins (Flash, Java, etc.) erlaubt

# upgrade-insecure-requests
# → HTTP-Requests automatisch zu HTTPS upgraden

# block-all-mixed-content
# → Gemischte Inhalte (HTTP auf HTTPS-Seite) blockieren

# =============================================================================
# NONCE GENERATION (Beispiel für Node.js)
# =============================================================================

# const crypto = require('crypto');
# const nonce = crypto.randomBytes(16).toString('base64');
# 
# // In HTML Template:
# <script nonce="${nonce}">
#   // Inline JavaScript hier
# </script>

# =============================================================================
# CSP TESTING & MONITORING
# =============================================================================

# Report-Only Mode für Testing:
# Content-Security-Policy-Report-Only: [POLICY]
# 
# Report-URI für Violation Reports:
# report-uri https://api.jobcoach-muenster.de/csp-report
# 
# Moderne Report-To API:
# report-to csp-endpoint